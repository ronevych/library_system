{% extends "base.html" %}
{% block title %}Каталог книг{% endblock %}
{% block content %}
<div class="mb-4 text-center">
  <h1 class="display-6">Каталог бібліотеки</h1>
  <p class="text-muted mb-0">
    Оберіть книгу для оренди. Щоб оформити запит, увійдіть або зареєструйтеся.
  </p>
</div>

<form class="row g-2 align-items-center mb-4" method="get" action="{{ url_for('store.catalog') }}">
  <div class="col-sm-8 col-md-6 col-lg-4">
    <label class="visually-hidden" for="search-query">Пошук</label>
    <input
      type="text"
      id="search-query"
      name="q"
      class="form-control"
      placeholder="Введіть назву, автора або жанр"
      value="{{ query }}"
    >
  </div>
  <div class="col-auto">
    <button class="btn btn-outline-primary" type="submit">Знайти</button>
  </div>
  {% if query %}
  <div class="col-auto">
    <a class="btn btn-link text-decoration-none" href="{{ url_for('store.catalog') }}">Скинути</a>
  </div>
  {% endif %}
</form>

<div class="row g-4">
  {% for book in books %}
  <div class="col-md-6 col-lg-4">
    <div class="card h-100 shadow-sm">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title">{{ book.title }}</h5>
        <h6 class="card-subtitle mb-2 text-muted">{{ book.author }}</h6>
        <p class="card-text">
          <span class="badge bg-secondary">{{ book.genre }}</span><br>
          Застава: {{ book.collateral_value }} грн<br>
          Оренда: {{ book.daily_rent_price }} грн/день
        </p>
        <div class="mt-auto">
          <p class="card-text small text-muted">
            Доступно примірників: {{ book.available_copies }}
          </p>
          {% if is_authenticated() %}
          <form method="post" action="{{ url_for('store.rent_book') }}" class="d-flex flex-column gap-2">
            <input type="hidden" name="book_id" value="{{ book.id }}">
            <div class="d-flex align-items-center gap-2">
              <label class="form-label mb-0 small" for="days-{{ book.id }}">Кількість днів:</label>
              <select name="days" id="days-{{ book.id }}" class="form-select form-select-sm w-auto">
                <option value="7">7</option>
                <option value="14" selected>14</option>
                <option value="21">21</option>
                <option value="30">30</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary btn-sm">Оформити оренду</button>
          </form>
          {% else %}
          <a href="{{ url_for('auth.login_form') }}" class="btn btn-outline-primary mt-2">
            Увійти для оренди
          </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  {% else %}
  <div class="col-12 text-center text-muted">
    {% if query %}
    За запитом «{{ query }}» нічого не знайдено. Спробуйте змінити критерії пошуку.
    {% else %}
    Немає доступних книг.
    {% endif %}
  </div>
  {% endfor %}
</div>
{% endblock %}

