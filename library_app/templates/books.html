{% extends "base.html" %}
{% block title %}Книги{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1>Каталог книг</h1>
</div>
<div class="row">
  <div class="col-lg-8">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Назва</th>
          <th>Автор</th>
          <th>Жанр</th>
          <th>Запас</th>
        </tr>
      </thead>
      <tbody>
        {% for book in books %}
        <tr>
          <td>{{ book.title }}</td>
          <td>{{ book.author }}</td>
          <td>{{ book.genre }}</td>
          <td>
            <form method="post" action="{{ url_for('books.update_stock', book_id=book.id) }}" class="stock-input" style="display: inline-flex; align-items: center; gap: 0.5rem;">
              <button type="button" class="btn btn-sm btn-outline-secondary" onclick="decreaseStock({{ book.id }})" style="padding: 0.25rem 0.5rem; min-width: 36px; height: 36px; border-radius: 8px; font-weight: 600;">−</button>
              <input type="number" 
                     id="stock-{{ book.id }}" 
                     name="available_copies" 
                     value="{{ book.available_copies }}" 
                     min="0" 
                     class="form-control form-control-sm" 
                     style="width: 80px; text-align: center; font-weight: 600; font-size: 1rem;"
                     onchange="this.form.submit()">
              <button type="button" class="btn btn-sm btn-outline-secondary" onclick="increaseStock({{ book.id }})" style="padding: 0.25rem 0.5rem; min-width: 36px; height: 36px; border-radius: 8px; font-weight: 600;">+</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="4" class="text-center">Немає книг</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="col-lg-4">
    <div class="card">
      <div class="card-header">Додати книгу</div>
      <div class="card-body">
        <form action="/books/" method="post">
          <div class="mb-2">
            <label class="form-label">Назва</label>
            <input type="text" class="form-control" name="title" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Автор</label>
            <input type="text" class="form-control" name="author" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Жанр</label>
            <input type="text" class="form-control" name="genre" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Заставна вартість</label>
            <input type="number" step="0.01" class="form-control" name="collateral_value" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Щоденна вартість оренди</label>
            <input type="number" step="0.01" class="form-control" name="daily_rent_price" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Доступні примірники</label>
            <input type="number" class="form-control" name="available_copies" value="1">
          </div>
          <button class="btn btn-primary w-100" type="submit">Зберегти</button>
        </form>
      </div>
    </div>
  </div>
</div>
<script>
function increaseStock(bookId) {
  const input = document.getElementById('stock-' + bookId);
  const currentValue = parseInt(input.value) || 0;
  input.value = currentValue + 1;
  input.form.submit();
}

function decreaseStock(bookId) {
  const input = document.getElementById('stock-' + bookId);
  const currentValue = parseInt(input.value) || 0;
  if (currentValue > 0) {
    input.value = currentValue - 1;
    input.form.submit();
  }
}
</script>
{% endblock %}

